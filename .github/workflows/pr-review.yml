name: Argus PR Review

on:
  workflow_dispatch: # manually trigger only â€” uncomment below to auto-run on PRs
  # pull_request:
  #   branches: [main, develop]

jobs:
  review:
    name: AI Review
    runs-on: ubuntu-latest
    environment: develop
    permissions:
      contents: read
      pull-requests: write
    steps:
      - uses: actions/checkout@v4

      - uses: astral-sh/setup-uv@v5
        with:
          enable-cache: true

      - run: uv sync --no-dev --extra embeddings

      - name: Run Argus review
        env:
          GITHUB_TOKEN: ${{ github.token }}
          INPUT_MODE: "review"
          INPUT_MODEL: "google-gla:gemini-2.5-flash"
          INPUT_MAX_TOKENS: "1000000"
          INPUT_TEMPERATURE: "0.0"
          INPUT_CONFIDENCE_THRESHOLD: "0.7"
          INPUT_IGNORED_PATHS: ""
          INPUT_STORAGE_DIR: ".argus-artifacts"
          INPUT_ENABLE_AGENTIC: "false"
          INPUT_EMBEDDING_MODEL: "local:all-MiniLM-L6-v2"
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
        run: uv run python -m argus.interfaces.main
